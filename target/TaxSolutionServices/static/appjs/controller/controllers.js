'use strict';

angular.module('myApp').controller(
				'LoginController',
				function($rootScope, $scope, AuthSharedService) {
					$scope.rememberMe = true;
					$scope.login = function() {
						$rootScope.authenticationError = false;
						AuthSharedService.login($scope.ssoId, $scope.password,
								$scope.rememberMe);
					}
				})
		.controller(
				'RegistrationController',
				function($rootScope, $scope, RegistraionService) {
					$scope.register = function() {
						 alert("User Id"+$rootScope.userIdRegis);
			    		 alert("Password"+$scope.registrationPass);
			    		 alert("Re-Password"+$scope.registrationRePass);
			    		 RegistraionService.submitForm($scope.userIdRegis,
								$scope.registrationPass,
								$scope.registrationRePass);
					}
				})
		.controller('HomeController', function($scope, HomeService) {
			$scope.technos = HomeService.getTechno();
		})
		.controller('UsersController', function($scope, $log, UsersService) {
			$scope.users = UsersService.getAll();
		})
		.controller(
				'ApiDocController',
				function($scope) {
					// init form
					$scope.isLoading = false;
					$scope.url = $scope.swaggerUrl = 'v2/api-docs';
					// error management
					$scope.myErrorHandler = function(data, status) {
						console.log('failed to load swagger: ' + status + '   '
								+ data);
					};

					$scope.infos = false;
				})
		.controller(
				'TokensController',
				function($scope, UsersService, TokensService, $q) {

					var browsers = [ "Firefox", 'Chrome', 'Trident' ]

					$q
							.all(
									[ UsersService.getAll().$promise,
											TokensService.getAll().$promise ])
							.then(
									function(data) {
										var users = data[0];
										var tokens = data[1];

										tokens
												.forEach(function(token) {
													users
															.forEach(function(
																	user) {
																if (token.userLogin === user.login) {
																	token.firstName = user.firstName;
																	token.familyName = user.familyName;
																	browsers
																			.forEach(function(
																					browser) {
																				if (token.userAgent
																						.indexOf(browser) > -1) {
																					token.browser = browser;
																				}
																			});
																}
															});
												});

										$scope.tokens = tokens;
									});

				}).controller('LogoutController', function(AuthSharedService) {
			AuthSharedService.logout();
		}).controller('ErrorController', function($scope, $routeParams) {
			$scope.code = $routeParams.code;

			switch ($scope.code) {
			case "403":
				$scope.message = "Oops! you have come to unauthorised page."
				break;
			case "404":
				$scope.message = "Page not found."
				break;
			default:
				$scope.code = 500;
				$scope.message = "Oops! unexpected error"
			}

		});